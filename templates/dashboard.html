<!DOCTYPE html>
<html lang="en" data-theme="terminal" data-mode="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OLLAMA // CONTROL CENTER</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&family=Share+Tech+Mono&family=Orbitron:wght@400;600;700;900&family=Exo+2:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
<style>
/* ══════════════════════════════════════════════════════════════════
   THEME SYSTEM — 3 themes x 2 modes = 6 visual modes
   ══════════════════════════════════════════════════════════════════ */
[data-theme="terminal"][data-mode="dark"] {
  --bg-deep:#060a0e; --bg-panel:#0c1117; --bg-panel-alt:#0f161d;
  --border:#1a2736; --border-glow:#1e3a50;
  --text-primary:#c8d4de; --text-dim:#5a6a7a; --text-muted:#3a4a5a;
  --accent-1:#00e87b; --accent-2:#f0a030; --accent-3:#00c8e0; --accent-4:#3080ff; --accent-err:#ff3b4a;
  --glow-1:rgba(0,232,123,0.15); --glow-2:rgba(240,160,48,0.15);
  --font-display:'Share Tech Mono', monospace; --font-body:'JetBrains Mono', monospace;
  --radius:6px; --scanline:rgba(0,0,0,0.03); --bg-gradient:none;
  --card-hover-shadow:none; --card-hover-transform:none;
}
[data-theme="terminal"][data-mode="light"] {
  --bg-deep:#f0f2f4; --bg-panel:#ffffff; --bg-panel-alt:#f6f8fa;
  --border:#d8dce0; --border-glow:#b0b8c0;
  --text-primary:#1a2430; --text-dim:#5a6878; --text-muted:#8a96a4;
  --accent-1:#00a858; --accent-2:#c08020; --accent-3:#0090a8; --accent-4:#2060d0; --accent-err:#d0283a;
  --glow-1:rgba(0,168,88,0.08); --glow-2:rgba(192,128,32,0.08);
  --font-display:'Share Tech Mono', monospace; --font-body:'JetBrains Mono', monospace;
  --radius:6px; --scanline:transparent; --bg-gradient:none;
  --card-hover-shadow:0 2px 8px rgba(0,0,0,0.06); --card-hover-transform:none;
}
[data-theme="cyberpunk"][data-mode="dark"] {
  --bg-deep:#0d0221; --bg-panel:#150535; --bg-panel-alt:#1a0a40;
  --border:#2a1060; --border-glow:#6b20d0;
  --text-primary:#e0d0ff; --text-dim:#8a6abf; --text-muted:#5a3a8f;
  --accent-1:#00ff8a; --accent-2:#ff2d7a; --accent-3:#00e5ff; --accent-4:#ffe03a; --accent-err:#ff2d4a;
  --glow-1:rgba(0,255,138,0.2); --glow-2:rgba(255,45,122,0.2);
  --font-display:'Orbitron', sans-serif; --font-body:'JetBrains Mono', monospace;
  --radius:8px; --scanline:rgba(255,45,122,0.015);
  --bg-gradient:radial-gradient(ellipse at 20% 50%,rgba(107,32,208,0.15) 0%,transparent 50%),radial-gradient(ellipse at 80% 20%,rgba(255,45,122,0.08) 0%,transparent 50%);
  --card-hover-shadow:0 4px 20px rgba(107,32,208,0.2); --card-hover-transform:translateY(-2px);
}
[data-theme="cyberpunk"][data-mode="light"] {
  --bg-deep:#f4f0ff; --bg-panel:#ffffff; --bg-panel-alt:#f8f4ff;
  --border:#d8c8f0; --border-glow:#a070e0;
  --text-primary:#1a0840; --text-dim:#6a4a9f; --text-muted:#a088c8;
  --accent-1:#00b860; --accent-2:#d0206a; --accent-3:#0098c0; --accent-4:#c0a000; --accent-err:#d01840;
  --glow-1:rgba(0,184,96,0.1); --glow-2:rgba(208,32,106,0.1);
  --font-display:'Orbitron', sans-serif; --font-body:'JetBrains Mono', monospace;
  --radius:8px; --scanline:transparent; --bg-gradient:none;
  --card-hover-shadow:0 4px 16px rgba(107,32,208,0.08); --card-hover-transform:translateY(-1px);
}
[data-theme="ocean"][data-mode="dark"] {
  --bg-deep:#04101e; --bg-panel:#081828; --bg-panel-alt:#0a1e32;
  --border:#14304a; --border-glow:#1e5080;
  --text-primary:#c4daf0; --text-dim:#6890b0; --text-muted:#3a5a78;
  --accent-1:#00d4aa; --accent-2:#2898ff; --accent-3:#50c8ff; --accent-4:#ff8a40; --accent-err:#ff4050;
  --glow-1:rgba(0,212,170,0.15); --glow-2:rgba(40,152,255,0.18);
  --font-display:'Exo 2', sans-serif; --font-body:'JetBrains Mono', monospace;
  --radius:10px; --scanline:transparent;
  --bg-gradient:radial-gradient(ellipse at 30% 80%,rgba(40,152,255,0.06) 0%,transparent 60%),radial-gradient(ellipse at 70% 20%,rgba(0,212,170,0.04) 0%,transparent 50%);
  --card-hover-shadow:0 2px 16px rgba(40,152,255,0.1); --card-hover-transform:none;
}
[data-theme="ocean"][data-mode="light"] {
  --bg-deep:#f0f6fc; --bg-panel:#ffffff; --bg-panel-alt:#f4f9ff;
  --border:#c8d8e8; --border-glow:#7098c0;
  --text-primary:#0a1e30; --text-dim:#4a6a88; --text-muted:#90a8c0;
  --accent-1:#00a888; --accent-2:#1878d0; --accent-3:#3098d0; --accent-4:#d07030; --accent-err:#d03040;
  --glow-1:rgba(0,168,136,0.08); --glow-2:rgba(24,120,208,0.08);
  --font-display:'Exo 2', sans-serif; --font-body:'JetBrains Mono', monospace;
  --radius:10px; --scanline:transparent; --bg-gradient:none;
  --card-hover-shadow:0 2px 12px rgba(40,120,208,0.06); --card-hover-transform:none;
}

/* ══════════════════════════════════════════════════════════════════
   BASE STYLES
   ══════════════════════════════════════════════════════════════════ */
* { margin:0; padding:0; box-sizing:border-box; }
body {
  font-family: var(--font-body);
  background: var(--bg-deep);
  background-image: var(--bg-gradient);
  color: var(--text-primary);
  min-height: 100vh;
  overflow-x: hidden;
  transition: background 0.3s, color 0.3s;
}
body::after {
  content:''; position:fixed; inset:0; pointer-events:none; z-index:9999;
  background: repeating-linear-gradient(0deg,transparent,transparent 2px,var(--scanline) 2px,var(--scanline) 4px);
}

/* ── Header ──────────────────────────────────────────────────── */
.header {
  display:flex; align-items:center; justify-content:space-between;
  padding:12px 20px; border-bottom:1px solid var(--border);
  background: var(--bg-panel-alt); flex-wrap:wrap; gap:10px;
}
.header-left { display:flex; align-items:center; gap:14px; }
.logo-mark {
  width:34px; height:34px; border:2px solid var(--accent-1);
  border-radius:var(--radius); display:flex; align-items:center; justify-content:center;
  font-size:18px; font-weight:700; color:var(--accent-1);
  text-shadow:0 0 12px var(--glow-1);
  animation:logoPulse 3s ease-in-out infinite;
}
@keyframes logoPulse {
  0%,100%{box-shadow:0 0 8px var(--glow-1)}
  50%{box-shadow:0 0 20px var(--glow-1)}
}
.header-title {
  font-family:var(--font-display); font-size:20px; letter-spacing:3px; color:var(--text-primary);
}
.header-title span { color:var(--text-muted); }
.header-right { display:flex; align-items:center; gap:12px; flex-wrap:wrap; }

/* ── Nav tabs ────────────────────────────────────────────────── */
.nav-tabs { display:flex; gap:4px; }
.nav-tab {
  background:transparent; border:1px solid var(--border); color:var(--text-dim);
  font-family:var(--font-body); font-size:13px; letter-spacing:1px;
  text-transform:uppercase; padding:5px 12px; border-radius:var(--radius);
  cursor:pointer; transition:all 0.2s;
}
.nav-tab:hover { border-color:var(--accent-1); color:var(--accent-1); }
.nav-tab.active { border-color:var(--accent-1); color:var(--accent-1); background:var(--glow-1); }

/* ── Theme controls ──────────────────────────────────────────── */
.theme-controls { display:flex; align-items:center; gap:8px; }
.theme-select {
  background:var(--bg-deep); border:1px solid var(--border);
  color:var(--text-primary); font-family:var(--font-body); font-size:13px;
  padding:5px 8px; border-radius:var(--radius); cursor:pointer;
}
.mode-toggle {
  width:40px; height:22px; border-radius:11px; cursor:pointer;
  background:var(--border); position:relative; border:none; transition:background 0.3s;
}
.mode-toggle::after {
  content:''; position:absolute; top:3px; left:3px;
  width:16px; height:16px; border-radius:50%;
  background:var(--text-primary); transition:transform 0.3s;
}
[data-mode="light"] .mode-toggle { background:var(--accent-1); }
[data-mode="light"] .mode-toggle::after { transform:translateX(18px); }
.mode-label { font-size:13px; color:var(--text-dim); letter-spacing:1px; }

/* ── Connection + Clock + Uptime ─────────────────────────────── */
.header-status-group { display:flex; align-items:center; gap:16px; }
.conn-status { display:flex; align-items:center; gap:6px; font-size:13px; letter-spacing:1px; }
.conn-dot {
  width:7px; height:7px; border-radius:50%; background:var(--accent-1);
  box-shadow:0 0 8px var(--accent-1); animation:dotBlink 2s ease-in-out infinite;
}
.conn-dot.offline { background:var(--accent-err); box-shadow:0 0 8px var(--accent-err); }
@keyframes dotBlink { 0%,100%{opacity:1} 50%{opacity:0.4} }
.header-time { font-size:13px; color:var(--text-dim); }
.header-uptime {
  font-size:13px; color:var(--accent-1); letter-spacing:1px;
  display:flex; align-items:center; gap:5px;
}
.header-uptime-label { color:var(--text-muted); font-size:14px; letter-spacing:1.5px; text-transform:uppercase; }
.header-divider { width:1px; height:16px; background:var(--border); }

/* ── Main & Pages ────────────────────────────────────────────── */
.main { padding:16px 20px; }
.page { display:none; }
.page.active { display:block; }

/* ── Stats Row ───────────────────────────────────────────────── */
.stats-row {
  display:grid; grid-template-columns:repeat(auto-fit, minmax(175px,1fr));
  gap:12px; margin-bottom:16px;
}
.stat-card {
  background:var(--bg-panel); border:1px solid var(--border);
  border-radius:var(--radius); padding:14px 16px;
  position:relative; overflow:hidden; transition:all 0.3s;
}
.stat-card:hover { border-color:var(--border-glow); box-shadow:var(--card-hover-shadow); transform:var(--card-hover-transform); }
.stat-card::before { content:''; position:absolute; top:0; left:0; right:0; height:2px; }
.stat-card.c1::before { background:var(--accent-1); opacity:0.7; }
.stat-card.c2::before { background:var(--accent-2); opacity:0.7; }
.stat-card.c3::before { background:var(--accent-3); opacity:0.7; }
.stat-card.c4::before { background:var(--accent-4); opacity:0.7; }
.stat-label { font-size:14px; letter-spacing:2px; text-transform:uppercase; color:var(--text-dim); margin-bottom:6px; }
.stat-value { font-size:28px; font-weight:600; line-height:1; }
.stat-value.c1 { color:var(--accent-1); text-shadow:0 0 14px var(--glow-1); }
.stat-value.c2 { color:var(--accent-2); text-shadow:0 0 14px var(--glow-2); }
.stat-value.c3 { color:var(--accent-3); }
.stat-value.c4 { color:var(--accent-4); }
.stat-sub { font-size:13px; color:var(--text-dim); margin-top:5px; }

/* ── Panels ──────────────────────────────────────────────────── */
.grid-2 { display:grid; grid-template-columns:1fr 1fr; gap:14px; margin-bottom:14px; }
.grid-full { margin-bottom:14px; }
.panel {
  background:var(--bg-panel); border:1px solid var(--border);
  border-radius:var(--radius); overflow:hidden; transition:border-color 0.3s;
}
.panel-header {
  display:flex; align-items:center; justify-content:space-between;
  padding:10px 14px; border-bottom:1px solid var(--border); background:var(--bg-panel-alt);
}
.panel-title { font-size:13px; letter-spacing:2px; text-transform:uppercase; color:var(--text-dim); }
.panel-badge {
  font-size:14px; padding:2px 8px; border-radius:var(--radius);
  background:var(--glow-1); color:var(--accent-1); border:1px solid rgba(0,0,0,0.05);
}
.panel-body { padding:14px; }

/* ── Tables ──────────────────────────────────────────────────── */
.scroll-box { max-height:340px; overflow-y:auto; scrollbar-width:thin; scrollbar-color:var(--border) transparent; }
.scroll-box::-webkit-scrollbar { width:5px; }
.scroll-box::-webkit-scrollbar-thumb { background:var(--border); border-radius:3px; }
table { width:100%; border-collapse:collapse; }
th {
  text-align:left; font-size:14px; letter-spacing:1.5px; text-transform:uppercase;
  color:var(--text-muted); padding:7px 10px; border-bottom:1px solid var(--border);
  position:sticky; top:0; background:var(--bg-panel); z-index:1;
}
td { padding:8px 10px; font-size:14px; border-bottom:1px solid rgba(0,0,0,0.04); color:var(--text-dim); }
tr:hover td { background:var(--glow-1); }
.td-name { color:var(--accent-3); font-weight:500; }
.td-ok { color:var(--accent-1); font-weight:600; }
.td-err { color:var(--accent-err); font-weight:600; }
.td-dur { color:var(--accent-2); }
.td-dim { color:var(--text-muted); font-size:13px; }
.td-tok { color:var(--accent-4); font-weight:500; }

/* ── Status pips ─────────────────────────────────────────────── */
.pip { width:6px; height:6px; border-radius:50%; display:inline-block; margin-right:4px; }
.pip.on { background:var(--accent-1); box-shadow:0 0 6px var(--accent-1); }
.pip.off { background:var(--text-muted); }

/* ── Buttons ─────────────────────────────────────────────────── */
.btn {
  background:transparent; border:1px solid var(--accent-1); color:var(--accent-1);
  font-family:var(--font-body); font-size:13px; letter-spacing:1px;
  text-transform:uppercase; padding:6px 14px; border-radius:var(--radius);
  cursor:pointer; transition:all 0.2s;
}
.btn:hover { background:var(--glow-1); box-shadow:0 0 10px var(--glow-1); }
.btn:disabled { opacity:0.3; cursor:not-allowed; }
.btn.c2 { border-color:var(--accent-2); color:var(--accent-2); }
.btn.c2:hover { background:var(--glow-2); }
.btn.err { border-color:var(--accent-err); color:var(--accent-err); }
.btn.err:hover { background:rgba(255,59,74,0.08); }

/* ── Filter bar ──────────────────────────────────────────────── */
.filter-bar { display:flex; gap:6px; padding:10px 14px; flex-wrap:wrap; border-bottom:1px solid var(--border); }
.filter-btn {
  background:var(--bg-deep); border:1px solid var(--border); color:var(--text-dim);
  font-family:var(--font-body); font-size:14px; padding:4px 10px;
  border-radius:var(--radius); cursor:pointer; transition:all 0.2s;
}
.filter-btn:hover, .filter-btn.active { border-color:var(--accent-3); color:var(--accent-3); background:rgba(0,0,0,0.1); }

/* ── Inputs ──────────────────────────────────────────────────── */
.input {
  background:var(--bg-deep); border:1px solid var(--border); color:var(--text-primary);
  font-family:var(--font-body); font-size:14px; padding:6px 10px;
  border-radius:var(--radius); outline:none;
}
.input:focus { border-color:var(--accent-1); }
.input-sm { width:70px; text-align:center; font-size:13px; padding:5px 8px; }

/* ── Bench metrics ───────────────────────────────────────────── */
.bench-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(130px,1fr)); gap:10px; }
.bench-m {
  background:var(--bg-deep); border:1px solid var(--border);
  border-radius:var(--radius); padding:12px; text-align:center;
}
.bench-m-label { font-size:14px; letter-spacing:1.5px; text-transform:uppercase; color:var(--text-muted); margin-bottom:5px; }
.bench-m-value { font-size:24px; font-weight:600; }
.chart-wrap { position:relative; height:180px; margin-top:12px; }

/* ── Events ──────────────────────────────────────────────────── */
.event-line { display:flex; align-items:center; gap:8px; padding:5px 0; font-size:14px; border-bottom:1px solid rgba(0,0,0,0.04); }
.event-time { color:var(--text-muted); font-size:13px; min-width:140px; }
.event-tag { font-size:14px; letter-spacing:1px; text-transform:uppercase; padding:2px 6px; border-radius:2px; font-weight:600; }
.event-tag.load { background:var(--glow-1); color:var(--accent-1); }
.event-tag.unload { background:var(--glow-2); color:var(--accent-2); }
.event-model { color:var(--accent-3); }

/* ── Controls bar ────────────────────────────────────────────── */
.controls-bar {
  display:flex; align-items:center; justify-content:space-between;
  padding:12px 20px; border-top:1px solid var(--border); background:var(--bg-panel);
  flex-wrap:wrap; gap:8px;
}
.controls-group { display:flex; align-items:center; gap:8px; flex-wrap:wrap; }
.controls-info { font-size:14px; color:var(--text-muted); letter-spacing:1px; }

/* ── Update checker ──────────────────────────────────────────── */
.update-card {
  background:var(--bg-panel); border:1px solid var(--border);
  border-radius:var(--radius); padding:16px; margin-bottom:14px;
}
.update-card h3 { font-size:14px; letter-spacing:2px; text-transform:uppercase; color:var(--text-dim); margin-bottom:12px; }
.pkg-row { display:flex; align-items:center; justify-content:space-between; padding:8px 0; border-bottom:1px solid rgba(0,0,0,0.04); font-size:14px; }
.pkg-name { color:var(--accent-3); font-weight:500; }
.pkg-ver { color:var(--text-dim); }
.pkg-new { color:var(--accent-1); font-weight:600; }
.pkg-ok { color:var(--text-muted); }
.cmd-block {
  background:var(--bg-deep); border:1px solid var(--border); border-radius:var(--radius);
  padding:12px 14px; font-size:14px; color:var(--accent-3); line-height:1.8;
  margin-top:10px; white-space:pre-wrap; position:relative;
}
.cmd-copy {
  position:absolute; top:8px; right:8px; background:var(--bg-panel);
  border:1px solid var(--border); color:var(--text-dim); font-size:14px;
  padding:3px 8px; border-radius:3px; cursor:pointer;
}
.cmd-copy:hover { color:var(--accent-1); border-color:var(--accent-1); }

/* ── Toast ───────────────────────────────────────────────────── */
.toast {
  position:fixed; bottom:20px; right:20px; background:var(--bg-panel);
  border:1px solid var(--accent-1); color:var(--accent-1);
  padding:10px 18px; border-radius:var(--radius); font-size:14px;
  z-index:10000; opacity:0; transform:translateY(8px);
  transition:all 0.3s; pointer-events:none;
}
.toast.show { opacity:1; transform:translateY(0); }
.toast.error { border-color:var(--accent-err); color:var(--accent-err); }

/* ── Spinner ─────────────────────────────────────────────────── */
.spinner {
  display:inline-block; width:12px; height:12px;
  border:2px solid var(--border); border-top-color:var(--accent-1);
  border-radius:50%; animation:spin 0.8s linear infinite;
}
@keyframes spin { to{transform:rotate(360deg)} }

.empty { text-align:center; padding:24px; font-size:14px; color:var(--text-muted); letter-spacing:1px; }

/* ── Responsive ──────────────────────────────────────────────── */
@media(max-width:900px) {
  .grid-2{grid-template-columns:1fr}
  .stats-row{grid-template-columns:repeat(2,1fr)}
  .header{flex-direction:column;gap:8px}
}
</style>
</head>
<body>

<!-- ════════ HEADER ════════ -->
<div class="header">
  <div class="header-left">
    <div class="logo-mark">O</div>
    <div class="header-title">OLLAMA <span>//</span> CONTROL CENTER</div>
  </div>
  <div class="header-right">
    <div class="nav-tabs">
      <button class="nav-tab active" onclick="showPage('dashboard',this)">Dashboard</button>
      <button class="nav-tab" onclick="showPage('updates',this)">Updates</button>
    </div>
    <div class="theme-controls">
      <select class="theme-select" id="themeSelect" onchange="setTheme(this.value)">
        <option value="terminal">Terminal</option>
        <option value="cyberpunk">Cyberpunk</option>
        <option value="ocean">Ocean</option>
      </select>
      <button class="mode-toggle" id="modeToggle" onclick="toggleMode()" title="Toggle light/dark"></button>
      <span class="mode-label" id="modeLabel">DARK</span>
    </div>
    <div class="header-status-group">
      <div class="conn-status">
        <div class="conn-dot" id="connDot"></div>
        <span id="connLabel">CONNECTING</span>
      </div>
      <div class="header-divider"></div>
      <div class="header-uptime">
        <span class="header-uptime-label">UPTIME</span>
        <span id="uptime">00:00:00</span>
      </div>
      <div class="header-divider"></div>
      <div class="header-time" id="headerTime">--:--:--</div>
    </div>
  </div>
</div>

<!-- ════════ PAGE: DASHBOARD ════════ -->
<div class="main">
<div class="page active" id="page-dashboard">

  <!-- Stats -->
  <div class="stats-row">
    <div class="stat-card c1">
      <div class="stat-label">Active Model</div>
      <div class="stat-value c1" id="activeModel" style="font-size:14px;">—</div>
      <div class="stat-sub" id="activeModelSub">No model loaded</div>
    </div>
    <div class="stat-card c2">
      <div class="stat-label">GPU Memory</div>
      <div class="stat-value c2" id="gpuMem">—</div>
      <div class="stat-sub" id="gpuMemSub">VRAM usage</div>
    </div>
    <div class="stat-card c3">
      <div class="stat-label">Token Speed</div>
      <div class="stat-value c3" id="tokenSpeed">—</div>
      <div class="stat-sub">Last benchmark tok/s</div>
    </div>
    <div class="stat-card c4">
      <div class="stat-label">Total Requests</div>
      <div class="stat-value c4" id="totalReqs">0</div>
      <div class="stat-sub" id="totalReqsSub">Tracked</div>
    </div>
    <div class="stat-card c1">
      <div class="stat-label">Models</div>
      <div class="stat-value c1" id="modelsCount">0</div>
      <div class="stat-sub" id="modelsSize">0 GB total</div>
    </div>
    <div class="stat-card c2">
      <div class="stat-label">Total Tokens</div>
      <div class="stat-value c2" id="totalTokens">0</div>
      <div class="stat-sub" id="totalTokensSub">Generated</div>
    </div>
  </div>

  <!-- Models + Benchmark -->
  <div class="grid-2">
    <div class="panel">
      <div class="panel-header">
        <div class="panel-title">Available Models</div>
        <div class="panel-badge" id="modelsBadge">0</div>
      </div>
      <div class="panel-body" style="padding:0;">
        <div class="scroll-box" style="max-height:300px;">
          <table><thead><tr><th>Model</th><th>Size</th><th>Quant</th><th>Status</th></tr></thead>
          <tbody id="modelsBody"><tr><td colspan="4" class="empty">Loading...</td></tr></tbody></table>
        </div>
      </div>
    </div>
    <div class="panel">
      <div class="panel-header">
        <div class="panel-title">Performance Benchmark</div>
        <div class="panel-badge" id="benchBadge">0 runs</div>
      </div>
      <div class="panel-body">
        <div style="display:flex;gap:8px;align-items:center;margin-bottom:12px;flex-wrap:wrap;">
          <select class="input" id="benchModel"></select>
          <button class="btn" id="benchBtn" onclick="runBenchmark()">▶ Run</button>
        </div>
        <div class="bench-grid">
          <div class="bench-m"><div class="bench-m-label">Generation</div><div class="bench-m-value c1" id="brTokSec">—</div></div>
          <div class="bench-m"><div class="bench-m-label">Tokens</div><div class="bench-m-value c2" id="brTokens">—</div></div>
          <div class="bench-m"><div class="bench-m-label">Prompt Eval</div><div class="bench-m-value c3" id="brPromptRate">—</div></div>
          <div class="bench-m"><div class="bench-m-label">Total Time</div><div class="bench-m-value c4" id="brTotal">—</div></div>
        </div>
        <div class="chart-wrap"><canvas id="benchChart"></canvas></div>
      </div>
    </div>
  </div>

  <!-- Request History -->
  <div class="grid-full">
    <div class="panel">
      <div class="panel-header">
        <div class="panel-title">Request History</div>
        <div class="panel-badge" id="histBadge">0</div>
      </div>
      <div class="filter-bar" id="filterBar">
        <button class="filter-btn active" data-filter="all" onclick="setFilter('all',this)">All Time</button>
        <button class="filter-btn" data-filter="today" onclick="setFilter('today',this)">Today</button>
        <button class="filter-btn" data-filter="7d" onclick="setFilter('7d',this)">7 Days</button>
        <button class="filter-btn" data-filter="30d" onclick="setFilter('30d',this)">30 Days</button>
        <button class="filter-btn" data-filter="6m" onclick="setFilter('6m',this)">6 Months</button>
        <button class="filter-btn" data-filter="1y" onclick="setFilter('1y',this)">Last Year</button>
        <button class="filter-btn" data-filter="ty" onclick="setFilter('ty',this)">This Year</button>
      </div>
      <div class="panel-body" style="padding:0;">
        <div class="scroll-box">
          <table><thead><tr><th>Time</th><th>Endpoint</th><th>Status</th><th>Duration</th><th>Tokens</th><th>Client</th></tr></thead>
          <tbody id="histBody"><tr><td colspan="6" class="empty">No requests logged yet</td></tr></tbody></table>
        </div>
      </div>
    </div>
  </div>

  <!-- Events -->
  <div class="grid-full">
    <div class="panel">
      <div class="panel-header">
        <div class="panel-title">Model Events</div>
        <div class="panel-badge" id="eventsBadge">0</div>
      </div>
      <div class="panel-body">
        <div class="scroll-box" style="max-height:200px;" id="eventsBody">
          <div class="empty">No events recorded yet</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ════════ PAGE: UPDATES ════════ -->
<div class="page" id="page-updates">
  <div class="update-card">
    <h3>Dashboard Packages</h3>
    <div id="pkgList"><div class="empty">Click "Check for Updates" to scan</div></div>
  </div>
  <div class="update-card">
    <h3>Ollama-Intel Base Image</h3>
    <div id="imageInfo"><div class="empty">Click "Check for Updates" to scan</div></div>
  </div>
  <div class="update-card">
    <h3>Rebuild Commands</h3>
    <p style="font-size:14px;color:var(--text-dim);margin-bottom:10px;">Copy and paste these into your Unraid terminal to update.</p>
    <div style="font-size:13px;letter-spacing:1px;color:var(--text-muted);margin-bottom:6px;">DASHBOARD CONTAINER:</div>
    <div class="cmd-block" id="cmdDash">cd /mnt/user/appdata/ollama-dashboard-build
docker pull python:3.11-slim
docker build --no-cache -t ollama-dashboard .
# Then restart from Unraid Docker tab</div>
    <div style="font-size:13px;letter-spacing:1px;color:var(--text-muted);margin:14px 0 6px;">OLLAMA-INTEL CONTAINER:</div>
    <div class="cmd-block" id="cmdOllama">cd /mnt/user/appdata/ollama-build
docker pull intelanalytics/ipex-llm-inference-cpp-xpu:latest
docker build --no-cache -t ollama-intel .
# Then restart from Unraid Docker tab</div>
  </div>
  <div style="margin-top:14px;">
    <button class="btn" id="updateBtn" onclick="checkUpdates()">⟳ Check for Updates</button>
  </div>
</div>
</div>

<!-- ════════ CONTROLS BAR ════════ -->
<div class="controls-bar">
  <div class="controls-group">
    <span class="controls-info">TRIM BY COUNT:</span>
    <input type="number" class="input input-sm" id="trimCount" value="500" min="10">
    <button class="btn c2" onclick="trimByCount()">Trim</button>
    <span class="controls-info" style="margin-left:10px;">TRIM BY AGE:</span>
    <select class="input" id="trimMonths" style="font-size:13px;padding:5px 8px;">
      <option value="1">1 month</option>
      <option value="3">3 months</option>
      <option value="6" selected>6 months</option>
      <option value="12">12 months</option>
      <option value="24">24 months</option>
    </select>
    <button class="btn c2" onclick="trimByTime()">Trim</button>
    <button class="btn err" onclick="clearHistory()">Clear All</button>
    <button class="btn" onclick="exportHistory()">Export</button>
  </div>
  <div class="controls-group">
    <span class="controls-info" id="histFileInfo">—</span>
  </div>
</div>

<div class="toast" id="toast"></div>

<!-- ════════ JAVASCRIPT ════════ -->
<script>
const API = window.location.origin;
let benchChart = null;
const dashStart = Date.now();
let allHistory = { requests:[], benchmarks:[], events:[] };
let currentFilter = 'all';

// ── Theme System ─────────────────────────────────────────────
function setTheme(theme) {
  document.documentElement.setAttribute('data-theme', theme);
  localStorage.setItem('ollama-theme', theme);
  if (benchChart) rebuildChart();
}
function toggleMode() {
  const html = document.documentElement;
  const mode = html.getAttribute('data-mode') === 'dark' ? 'light' : 'dark';
  html.setAttribute('data-mode', mode);
  localStorage.setItem('ollama-mode', mode);
  document.getElementById('modeLabel').textContent = mode.toUpperCase();
  if (benchChart) rebuildChart();
}
function loadThemePrefs() {
  const t = localStorage.getItem('ollama-theme') || 'terminal';
  const m = localStorage.getItem('ollama-mode') || 'dark';
  document.documentElement.setAttribute('data-theme', t);
  document.documentElement.setAttribute('data-mode', m);
  document.getElementById('themeSelect').value = t;
  document.getElementById('modeLabel').textContent = m.toUpperCase();
}
loadThemePrefs();

// ── Navigation ───────────────────────────────────────────────
function showPage(page, el) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById('page-' + page).classList.add('active');
  document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
}

// ── Helpers ──────────────────────────────────────────────────
function fmtBytes(b) {
  if (!b) return '0 B';
  const u=['B','KB','MB','GB','TB'];
  const i=Math.floor(Math.log(b)/Math.log(1024));
  return (b/Math.pow(1024,i)).toFixed(1)+' '+u[i];
}
function fmtDur(ms) {
  if(ms<1000) return ms.toFixed(0)+'ms';
  if(ms<60000) return (ms/1000).toFixed(1)+'s';
  return (ms/60000).toFixed(1)+'m';
}
function fmtTime(iso) {
  try { const d=new Date(iso); return d.toLocaleString('en-GB',{day:'2-digit',month:'short',hour:'2-digit',minute:'2-digit',second:'2-digit'}); }
  catch { return iso; }
}
function fmtNum(n) {
  if(n>=1000000) return (n/1000000).toFixed(1)+'M';
  if(n>=1000) return (n/1000).toFixed(1)+'K';
  return n.toString();
}
function showToast(msg, err) {
  const t=document.getElementById('toast');
  t.textContent=msg; t.className=err?'toast error show':'toast show';
  setTimeout(()=>t.className='toast', 3000);
}

// ── Clock + Uptime ───────────────────────────────────────────
function tick() {
  const now=new Date();
  document.getElementById('headerTime').textContent=now.toLocaleTimeString('en-GB',{hour:'2-digit',minute:'2-digit',second:'2-digit'});
  const e=Date.now()-dashStart;
  const h=Math.floor(e/3600000), m=Math.floor((e%3600000)/60000), s=Math.floor((e%60000)/1000);
  document.getElementById('uptime').textContent=`${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
}
setInterval(tick,1000); tick();

// ── History Filtering ────────────────────────────────────────
function getFilterCutoff(filter) {
  const now = new Date();
  switch(filter) {
    case 'today': return new Date(now.getFullYear(),now.getMonth(),now.getDate()).toISOString();
    case '7d': return new Date(now-7*86400000).toISOString();
    case '30d': return new Date(now-30*86400000).toISOString();
    case '6m': return new Date(now.getFullYear(),now.getMonth()-6,now.getDate()).toISOString();
    case '1y': return new Date(now-365*86400000).toISOString();
    case 'ty': return new Date(now.getFullYear(),0,1).toISOString();
    default: return null;
  }
}
function filterEntries(entries, filter) {
  const cutoff = getFilterCutoff(filter);
  if (!cutoff) return entries;
  return entries.filter(e => (e.time||'') >= cutoff);
}
function setFilter(f, el) {
  currentFilter = f;
  document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
  el.classList.add('active');
  renderHistory();
}

// ── Fetch Status ─────────────────────────────────────────────
async function fetchStatus() {
  try {
    const r = await fetch(`${API}/api/status`);
    const d = await r.json();
    const dot=document.getElementById('connDot'), lbl=document.getElementById('connLabel');
    if(d.status==='online'){ dot.className='conn-dot'; lbl.textContent='ONLINE'; }
    else { dot.className='conn-dot offline'; lbl.textContent='OFFLINE'; }

    const running = d.running?.models||[];
    const el=document.getElementById('activeModel'), sub=document.getElementById('activeModelSub');
    if(running.length>0) {
      const m=running[0]; el.textContent=m.name||'—';
      const vram=m.size_vram||m.size||0;
      sub.textContent='VRAM: '+fmtBytes(vram);
      document.getElementById('gpuMem').textContent=fmtBytes(vram);
      document.getElementById('gpuMemSub').textContent=running.length+' model(s) loaded';
    } else {
      el.textContent='—'; sub.textContent='No model loaded';
      document.getElementById('gpuMem').textContent='0';
      document.getElementById('gpuMemSub').textContent='Idle';
    }

    const models=d.models?.models||[];
    const runNames=new Set(running.map(m=>m.name));
    document.getElementById('modelsCount').textContent=models.length;
    document.getElementById('modelsBadge').textContent=models.length;
    const totalSz=models.reduce((s,m)=>s+(m.size||0),0);
    document.getElementById('modelsSize').textContent=fmtBytes(totalSz)+' total';

    const tb=document.getElementById('modelsBody');
    if(!models.length){ tb.innerHTML='<tr><td colspan="4" class="empty">No models installed</td></tr>'; }
    else {
      tb.innerHTML=models.map(m=>{
        const a=runNames.has(m.name);
        return `<tr><td class="td-name">${m.name}</td><td class="td-dim">${fmtBytes(m.size)}</td>
        <td class="td-dim">${m.details?.quantization_level||'—'}</td>
        <td><span class="pip ${a?'on':'off'}"></span><span style="font-size:13px;letter-spacing:1px;color:${a?'var(--accent-1)':'var(--text-muted)'}">${a?'LOADED':'IDLE'}</span></td></tr>`;
      }).join('');
    }

    const sel=document.getElementById('benchModel');
    const cv=sel.value;
    sel.innerHTML=models.map(m=>`<option value="${m.name}" ${m.name===cv?'selected':''}>${m.name}</option>`).join('');
  } catch(e) {
    document.getElementById('connDot').className='conn-dot offline';
    document.getElementById('connLabel').textContent='ERROR';
  }
}

// ── Fetch & Render History ───────────────────────────────────
async function fetchHistory() {
  try {
    const r=await fetch(`${API}/api/history`);
    allHistory=await r.json();
    renderHistory();
    const sr=await fetch(`${API}/api/history/stats`);
    const sd=await sr.json();
    document.getElementById('histFileInfo').textContent=
      `Reqs: ${sd.requests} | Bench: ${sd.benchmarks} | Events: ${sd.events} | File: ${sd.file_size}`;
    // Update total tokens stat card
    document.getElementById('totalTokens').textContent=fmtNum(sd.total_tokens||0);
    document.getElementById('totalTokensSub').textContent=
      `${fmtNum(sd.total_gen_tokens||0)} gen + ${fmtNum(sd.total_prompt_tokens||0)} prompt`;
  } catch(e){}
}

function renderHistory() {
  const reqs=filterEntries(allHistory.requests||[], currentFilter).slice().reverse();
  document.getElementById('totalReqs').textContent=reqs.length;
  document.getElementById('totalReqsSub').textContent=reqs.length+' tracked';
  document.getElementById('histBadge').textContent=reqs.length;

  const hb=document.getElementById('histBody');
  if(!reqs.length){ hb.innerHTML='<tr><td colspan="6" class="empty">No requests in this period</td></tr>'; }
  else {
    hb.innerHTML=reqs.slice(0,300).map(r=>{
      const tokDisplay = (r.total_tokens && r.total_tokens > 0) ? r.total_tokens : '—';
      return `<tr>
        <td class="td-dim">${fmtTime(r.time)}</td>
        <td class="td-name">${r.path||'—'}</td>
        <td class="${r.status===200?'td-ok':'td-err'}">${r.status||'—'}</td>
        <td class="td-dur">${r.duration||'—'}</td>
        <td class="td-tok">${tokDisplay}</td>
        <td class="td-dim">${r.client_ip||'—'}</td>
      </tr>`;
    }).join('');
  }

  // Events
  const events=(allHistory.events||[]).slice().reverse();
  document.getElementById('eventsBadge').textContent=events.length;
  const eb=document.getElementById('eventsBody');
  if(!events.length){ eb.innerHTML='<div class="empty">No events recorded yet</div>'; }
  else {
    eb.innerHTML=events.slice(0,100).map(e=>`<div class="event-line">
      <span class="event-time">${fmtTime(e.time)}</span>
      <span class="event-tag ${e.type}">${e.type}</span>
      <span class="event-model">${e.model||'—'}</span>
    </div>`).join('');
  }

  // Benchmarks
  const benches=allHistory.benchmarks||[];
  document.getElementById('benchBadge').textContent=benches.length+' runs';
  if(benches.length>0){
    const last=benches[benches.length-1];
    document.getElementById('tokenSpeed').textContent=last.tokens_per_sec?.toFixed(1)||'—';
    document.getElementById('brTokSec').textContent=(last.tokens_per_sec?.toFixed(1)||'—')+' t/s';
    document.getElementById('brTokens').textContent=last.eval_count||'—';
    document.getElementById('brPromptRate').textContent=(last.prompt_eval_rate?.toFixed(1)||'—')+' t/s';
    document.getElementById('brTotal').textContent=fmtDur(last.total_duration_ms||0);
  }
  updateChart(benches);
}

// ── Chart ────────────────────────────────────────────────────
function getChartColor() {
  return getComputedStyle(document.documentElement).getPropertyValue('--accent-1').trim();
}
function rebuildChart() {
  if(benchChart){benchChart.destroy();benchChart=null;}
  updateChart(allHistory.benchmarks||[]);
}
function updateChart(benches) {
  const ctx=document.getElementById('benchChart');
  if(!ctx) return;
  const labels=benches.map(b=>{try{return new Date(b.time).toLocaleTimeString('en-GB',{hour:'2-digit',minute:'2-digit'});}catch{return '?';}});
  const data=benches.map(b=>b.tokens_per_sec||0);
  const c=getChartColor();

  if(benchChart){
    benchChart.data.labels=labels;
    benchChart.data.datasets[0].data=data;
    benchChart.data.datasets[0].borderColor=c;
    benchChart.data.datasets[0].pointBackgroundColor=c;
    benchChart.data.datasets[0].pointBorderColor=c;
    benchChart.data.datasets[0].backgroundColor=c.replace(')',',0.08)').replace('rgb','rgba');
    benchChart.update('none');
  } else {
    benchChart=new Chart(ctx,{
      type:'line',
      data:{labels,datasets:[{label:'tok/s',data,borderColor:c,
        backgroundColor:c.replace(')',',0.08)').replace('rgb','rgba'),
        borderWidth:2,fill:true,tension:0.3,pointBackgroundColor:c,pointBorderColor:c,pointRadius:3,pointHoverRadius:5}]},
      options:{responsive:true,maintainAspectRatio:false,
        plugins:{legend:{display:false},tooltip:{backgroundColor:'#0c1117',borderColor:'#1a2736',borderWidth:1,
          titleFont:{family:'JetBrains Mono',size:10},bodyFont:{family:'JetBrains Mono',size:11},
          titleColor:'#5a6a7a',bodyColor:c}},
        scales:{x:{ticks:{color:'#3a4a5a',font:{family:'JetBrains Mono',size:9}},grid:{color:'rgba(26,39,54,0.4)'}},
          y:{ticks:{color:'#3a4a5a',font:{family:'JetBrains Mono',size:9},callback:v=>v+' t/s'},grid:{color:'rgba(26,39,54,0.4)'}}}}
    });
  }
}

// ── Benchmark ────────────────────────────────────────────────
async function runBenchmark() {
  const model=document.getElementById('benchModel').value;
  if(!model){showToast('No model selected',true);return;}
  const btn=document.getElementById('benchBtn');
  btn.disabled=true; btn.innerHTML='<span class="spinner"></span> Running...';
  try {
    const r=await fetch(`${API}/api/benchmark`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({model})});
    const d=await r.json();
    if(d.error){showToast(d.error,true);}
    else {
      document.getElementById('brTokSec').textContent=(d.tokens_per_sec?.toFixed(1)||'—')+' t/s';
      document.getElementById('brTokens').textContent=d.eval_count||'—';
      document.getElementById('brPromptRate').textContent=(d.prompt_eval_rate?.toFixed(1)||'—')+' t/s';
      document.getElementById('brTotal').textContent=fmtDur(d.total_duration_ms||0);
      document.getElementById('tokenSpeed').textContent=d.tokens_per_sec?.toFixed(1)||'—';
      showToast(`Benchmark: ${d.tokens_per_sec?.toFixed(1)} tok/s`);
      await fetchHistory();
    }
  } catch(e){showToast('Failed: '+e.message,true);}
  finally { btn.disabled=false; btn.innerHTML='▶ Run'; }
}

// ── Trim & Controls ──────────────────────────────────────────
async function trimByCount() {
  const keep=parseInt(document.getElementById('trimCount').value)||500;
  if(!confirm(`Trim history to the last ${keep} entries per category?`)) return;
  try {
    await fetch(`${API}/api/trim`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({mode:'count',keep})});
    showToast(`Trimmed to last ${keep} entries`);
    await fetchHistory();
  } catch(e){showToast('Trim failed',true);}
}
async function trimByTime() {
  const months=parseInt(document.getElementById('trimMonths').value)||6;
  if(!confirm(`Delete history older than ${months} month(s)?`)) return;
  try {
    await fetch(`${API}/api/trim`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({mode:'time',months})});
    showToast(`Removed data older than ${months} month(s)`);
    await fetchHistory();
  } catch(e){showToast('Trim failed',true);}
}
async function clearHistory() {
  if(!confirm('Clear ALL history? This cannot be undone.')) return;
  try {
    await fetch(`${API}/api/clear`,{method:'POST'});
    showToast('History cleared');
    await fetchHistory();
  } catch(e){showToast('Clear failed',true);}
}
async function exportHistory() {
  try {
    const r=await fetch(`${API}/api/history/export`);
    const b=await r.blob();
    const u=URL.createObjectURL(b);
    const a=document.createElement('a');
    a.href=u; a.download=`ollama-history-${new Date().toISOString().slice(0,10)}.json`;
    a.click(); URL.revokeObjectURL(u);
    showToast('Exported');
  } catch(e){showToast('Export failed',true);}
}

// ── Update Checker ───────────────────────────────────────────
async function checkUpdates() {
  const btn=document.getElementById('updateBtn');
  btn.disabled=true; btn.innerHTML='<span class="spinner"></span> Checking...';
  try {
    const r=await fetch(`${API}/api/updates`);
    const d=await r.json();

    const pkgs=d.dashboard_packages||[];
    if(pkgs.length){
      document.getElementById('pkgList').innerHTML=pkgs.map(p=>`<div class="pkg-row">
        <span class="pkg-name">${p.package}</span>
        <span class="pkg-ver">${p.current}</span>
        <span>→</span>
        <span class="${p.update_available?'pkg-new':'pkg-ok'}">${p.latest} ${p.update_available?'⬆ UPDATE':'✓'}</span>
      </div>`).join('');
    }

    const img=d.base_image||{};
    if(img.error){
      document.getElementById('imageInfo').innerHTML=`<div class="empty">${img.error}</div>`;
    } else {
      document.getElementById('imageInfo').innerHTML=`<div class="pkg-row">
        <span class="pkg-name">${img.container||'—'}</span>
        <span class="pkg-ver">${img.current_image_id||'—'}</span>
      </div><p style="font-size:14px;color:var(--text-dim);margin-top:8px;">${img.note||''}</p>`;
    }

    showToast('Update check complete');
  } catch(e){showToast('Check failed: '+e.message,true);}
  finally { btn.disabled=false; btn.innerHTML='⟳ Check for Updates'; }
}

// ── Polling ──────────────────────────────────────────────────
async function poll() { await fetchStatus(); await fetchHistory(); }
poll();
setInterval(poll, 5000);
</script>
</body>
</html>
